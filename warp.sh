#!/bin/bash

# setup / clear output directory
mkdir out/; rm out/*

# loop through jpg files
for f in *.jpg; do

	echo "Processing..." $f

	# get current filename
	FILEOUT=`echo $f | sed "s/.jpg/.tif/"`

	# apply the GCPs to the file
# 	gdal_translate -of GTiff -gcp 424.09 124.231 400 0 -gcp 482.9 122.448 500 0 -gcp 546.611 120.666 600 0 -gcp 612.55 118.439 700 0 -gcp 681.162 115.32 800 0 -gcp 752.447 112.647 900 0 -gcp 386.059 185.608 300 100 -gcp 444.073 185.066 400 100 -gcp 504.255 185.066 500 100 -gcp 565.522 182.626 600 100 -gcp 630.855 182.626 700 100 -gcp 697.543 181.542 800 100 -gcp 768.569 181 900 100 -gcp 842.577 179.373 1000 100 -gcp 345.124 246.197 200 200 -gcp 400.427 246.468 300 200 -gcp 457.356 247.281 400 200 -gcp 516.183 247.552 500 200 -gcp 578.805 248.908 600 200 -gcp 641.969 248.637 700 200 -gcp 708.929 249.179 800 200 -gcp 778.328 249.721 900 200 -gcp 850.981 250.263 1000 200 -gcp 249.7 304.482 0 300 -gcp 301.207 306.108 100 300 -gcp 352.715 307.735 200 300 -gcp 408.56 309.904 300 300 -gcp 464.404 311.53 400 300 -gcp 523.502 312.614 500 300 -gcp 583.685 315.325 600 300 -gcp 648.204 317.494 700 300 -gcp 714.351 319.663 800 300 -gcp 783.208 320.747 900 300 -gcp 854.776 323.458 1000 300 -gcp 929.597 325.627 1100 300 -gcp 249.7 364.664 0 400 -gcp 300.665 369.001 100 400 -gcp 352.715 370.628 200 400 -gcp 406.933 372.255 300 400 -gcp 464.947 376.592 400 400 -gcp 521.876 379.303 500 400 -gcp 582.6 382.556 600 400 -gcp 647.662 386.351 700 400 -gcp 712.182 389.604 800 400 -gcp 781.581 393.4 900 400 -gcp 853.15 397.195 1000 400 -gcp 927.971 401.532 1100 400 -gcp 242.652 426.473 0 500 -gcp 293.075 429.726 100 500 -gcp 346.208 432.979 200 500 -gcp 402.053 436.232 300 500 -gcp 456.814 442.196 400 500 -gcp 516.454 445.991 500 500 -gcp 576.636 451.413 600 500 -gcp 639.53 456.835 700 500 -gcp 706.76 461.173 800 500 -gcp 774.533 465.51 900 500 -gcp 846.101 471.474 1000 500 -gcp 229.639 484.758 0 600 -gcp 279.52 489.637 100 600 -gcp 332.654 493.432 200 600 -gcp 387.957 499.939 300 600 -gcp 443.801 504.276 400 600 -gcp 503.442 510.24 500 600 -gcp 564.166 516.204 600 600 -gcp 628.686 522.168 700 600 -gcp 694.29 528.132 800 600 -gcp 763.689 535.723 900 600 -gcp 836.342 542.229 1000 600 -gcp 258.917 547.109 100 700 -gcp 313.678 551.988 200 700 -gcp 368.98 558.766 300 700 -gcp 424.289 565.896 400 700 -gcp 484.621 572.776 500 700 -gcp 546.542 580.185 600 700 -gcp 610.315 588.124 700 700 -gcp 677.792 595.798 800 700 -gcp 748.445 604.001 900 700 -gcp 820.421 613.527 1000 700 -gcp 287.741 607.204 200 800 -gcp 341.732 615.249 300 800 -gcp 400.381 623.083 400 800 -gcp 460.512 631.976 500 800 -gcp 522.548 640.233 600 800 -gcp 587.125 648.702 700 800 -gcp 655.725 658.23 800 800 -gcp 726.442 668.393 900 800 -gcp 428.752 685.755 500 900 -gcp 491.847 695.494 600 900 -gcp 557.907 705.234 700 900 $f tmp.vrt
	gdal_translate -of GTiff $(python points2gcp.py) $f tmp.vrt

	# warp using a third order polynomial transformation
	gdalwarp -q -r bilinear -order 3 -co COMPRESS=NONE tmp.vrt out/$FILEOUT

# finish and tidy up
done; rm tmp.vrt